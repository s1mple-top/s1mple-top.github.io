<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<!--<![endif]-->

<head>
  <title>DOM Clobbering 拓展xss攻击面 | s1mple</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="s1mple">
    <meta name="author" content="s1mple">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="s1mple" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
    
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    

    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->

  
  
  

  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/" target="_BLANK" class="animsition-link"></a></li>
                    
                        <li><a href="/atom.xml" target="_BLANK" class="animsition-link"></a></li>
                    
                </ul>
            </li>
            
            
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a target="_blank" rel="noopener" href="https://blog.zeddyu.info/" class="animsition-link">陆队</a></li>
                    
                    <li><a target="_blank" rel="noopener" href="https://st4ck.gitee.io/" class="animsition-link">书鱼</a></li>
                    
                    <li><a target="_blank" rel="noopener" href="https://boluochuixue.top/" class="animsition-link">菠萝吹雪</a></li>
                    
                    <li><a target="_blank" rel="noopener" href="https://rmb122.com/" class="animsition-link">rmb</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">s1mple</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2021-10-02T07:38:42.000Z" itemprop="datePublished">
          2021-10-02
      </time>
    
</span>
                <h1>DOM Clobbering 拓展xss攻击面</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<h2 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h2><p>这篇文章在很多博客上看到，觉得很有意思，学习一波；</p>
<h2 id="正文："><a href="#正文：" class="headerlink" title="正文："></a>正文：</h2><p>其实通过细读陆队和一些其他的文章，Dom clobbering xss的本质就是利用id或者name去对全局变量的劫持覆盖；在目标站点的script代码中如果有相应的引用；就会造成漏洞；</p>
<p>先来看一下如何进行劫持；简单看一下图：</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/oZtNlR"><img src="https://z3.ax1x.com/2021/11/26/oZtNlR.png" alt="oZtNlR.png"></a></p>
<p>通过这个图不难理解，我们成功劫持掉了cookie；document.cookie已经成功被我们的标签给覆盖了；但是如果这里写入的是<code>&lt;img id=cookie&gt;</code>则无法success；具体的原因可以看下图：</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/oZU8z9"><img src="https://z3.ax1x.com/2021/11/26/oZU8z9.png" alt="oZU8z9.png"></a></p>
<p>这里显然易见我们可以通过id和name在document和window对象下创建一个新的对象；但是值得注意的是使用id的时候是无法被document来获取到的；需要用document.getElementById来进行获取所以这也是为什么当标签设置为<code>&lt;img id=cookie&gt;</code>的时候无法success的原因；</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/oZUOoT"><img src="https://z3.ax1x.com/2021/11/26/oZUOoT.png" alt="oZUOoT.png"></a></p>
<h3 id="劫持函数"><a href="#劫持函数" class="headerlink" title="劫持函数"></a>劫持函数</h3><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/oZDoSU"><img src="https://z3.ax1x.com/2021/11/26/oZDoSU.png" alt="oZDoSU.png"></a></p>
<p>可以很清楚的看到利用form和input进行覆盖函数，导致在后续的代码中无法识别函数；</p>
<h2 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h2><p>要想利用这个漏洞还是需要进一步的进行深入，因为当前测试的结果返回的仅仅是一个对象，无法返回string;当然我们可以测试一下强制类型进行转换；</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/oZwuZt"><img src="https://z3.ax1x.com/2021/11/26/oZwuZt.png" alt="oZwuZt.png"></a></p>
<p>如果进行强制类型转换，那么会回显为字符类型的object HTMLImageElement；用此去进行xss攻击显然是不现实的；</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/oZ0N1e"><img src="https://z3.ax1x.com/2021/11/26/oZ0N1e.png" alt="oZ0N1e.png"></a></p>
<p>所以现在的想法就是如何去将其内容控制为返回的字符串；</p>
<p>那么就需要去进行遍历，遍历到合适的标签让我们可以返回相应的string；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s1mple = <span class="built_in">Object</span>.getOwnPropertyNames(<span class="built_in">window</span>)</span><br><span class="line">.filter(<span class="function"><span class="params">p</span> =&gt;</span> p.match(<span class="regexp">/Element$/</span>))</span><br><span class="line">.map(<span class="function"><span class="params">p</span> =&gt;</span> <span class="built_in">window</span>[p])</span><br><span class="line">.filter(<span class="function"><span class="params">p</span> =&gt;</span> p &amp;&amp; p.prototype &amp;&amp; p.prototype.toString !== <span class="built_in">Object</span>.prototype.toString)</span><br><span class="line"><span class="built_in">console</span>.log(s1mple);</span><br></pre></td></tr></table></figure>

<p>用此代码去进行遍历，最后回显的结果为两种标签对象：</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/oZD8zD"><img src="https://z3.ax1x.com/2021/11/26/oZD8zD.png" alt="oZD8zD.png"></a></p>
<p>对应的就是area和a标签；利用这两种标签对象就可进行返回String；从而可进行xss；看一个测试图：</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/oZ6IE9"><img src="https://z3.ax1x.com/2021/11/27/oZ6IE9.png" alt="oZ6IE9.png"></a></p>
<p>证明是在a标签下可以利用href进行强制类型转换；至于area，换个标签就可；也可以实现弹窗；是会返回其href属性的value；</p>
<h2 id="两层利用："><a href="#两层利用：" class="headerlink" title="两层利用："></a>两层利用：</h2><p>上面的实验仅仅是建立在一层的基础之上，那么如果是两层甚至多层又如何触发xss？简单分析一下；</p>
<p>两层的一般形式就是x.y这种，需要去更内部去触发；</p>
<p>这里两层可以引入name属性去进行承接；</p>
<h3 id="HTMLCollection"><a href="#HTMLCollection" class="headerlink" title="HTMLCollection"></a>HTMLCollection</h3><p>我们可以通过相同id的标签创建来实现HTMLCollection的创建，如下：</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/oZRM8I"><img src="https://z3.ax1x.com/2021/11/27/oZRM8I.png" alt="oZRM8I.png"></a></p>
<p>就可实现双层的Dom clobbering点利用；area标签是一样的原理；</p>
<h3 id="HTML-Relationships"><a href="#HTML-Relationships" class="headerlink" title="HTML Relationships"></a>HTML Relationships</h3><p>在不用HTMLCollection的情况下也可采用html的层级关系来实现层级访问；整体fuzz一遍看看哪些组合可以实现层级访问；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> log=[];</span><br><span class="line"><span class="keyword">var</span> html = [<span class="string">&quot;a&quot;</span>,<span class="string">&quot;abbr&quot;</span>,<span class="string">&quot;acronym&quot;</span>,<span class="string">&quot;address&quot;</span>,<span class="string">&quot;applet&quot;</span>,<span class="string">&quot;area&quot;</span>,<span class="string">&quot;article&quot;</span>,<span class="string">&quot;aside&quot;</span>,<span class="string">&quot;audio&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;base&quot;</span>,<span class="string">&quot;basefont&quot;</span>,<span class="string">&quot;bdi&quot;</span>,<span class="string">&quot;bdo&quot;</span>,<span class="string">&quot;bgsound&quot;</span>,<span class="string">&quot;big&quot;</span>,<span class="string">&quot;blink&quot;</span>,<span class="string">&quot;blockquote&quot;</span>,<span class="string">&quot;body&quot;</span>,<span class="string">&quot;br&quot;</span>,<span class="string">&quot;button&quot;</span>,<span class="string">&quot;canvas&quot;</span>,<span class="string">&quot;caption&quot;</span>,<span class="string">&quot;center&quot;</span>,<span class="string">&quot;cite&quot;</span>,<span class="string">&quot;code&quot;</span>,<span class="string">&quot;col&quot;</span>,<span class="string">&quot;colgroup&quot;</span>,<span class="string">&quot;command&quot;</span>,<span class="string">&quot;content&quot;</span>,<span class="string">&quot;data&quot;</span>,<span class="string">&quot;datalist&quot;</span>,<span class="string">&quot;dd&quot;</span>,<span class="string">&quot;del&quot;</span>,<span class="string">&quot;details&quot;</span>,<span class="string">&quot;dfn&quot;</span>,<span class="string">&quot;dialog&quot;</span>,<span class="string">&quot;dir&quot;</span>,<span class="string">&quot;div&quot;</span>,<span class="string">&quot;dl&quot;</span>,<span class="string">&quot;dt&quot;</span>,<span class="string">&quot;element&quot;</span>,<span class="string">&quot;em&quot;</span>,<span class="string">&quot;embed&quot;</span>,<span class="string">&quot;fieldset&quot;</span>,<span class="string">&quot;figcaption&quot;</span>,<span class="string">&quot;figure&quot;</span>,<span class="string">&quot;font&quot;</span>,<span class="string">&quot;footer&quot;</span>,<span class="string">&quot;form&quot;</span>,<span class="string">&quot;frame&quot;</span>,<span class="string">&quot;frameset&quot;</span>,<span class="string">&quot;h1&quot;</span>,<span class="string">&quot;head&quot;</span>,<span class="string">&quot;header&quot;</span>,<span class="string">&quot;hgroup&quot;</span>,<span class="string">&quot;hr&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;i&quot;</span>,<span class="string">&quot;iframe&quot;</span>,<span class="string">&quot;image&quot;</span>,<span class="string">&quot;img&quot;</span>,<span class="string">&quot;input&quot;</span>,<span class="string">&quot;ins&quot;</span>,<span class="string">&quot;isindex&quot;</span>,<span class="string">&quot;kbd&quot;</span>,<span class="string">&quot;keygen&quot;</span>,<span class="string">&quot;label&quot;</span>,<span class="string">&quot;legend&quot;</span>,<span class="string">&quot;li&quot;</span>,<span class="string">&quot;link&quot;</span>,<span class="string">&quot;listing&quot;</span>,<span class="string">&quot;main&quot;</span>,<span class="string">&quot;map&quot;</span>,<span class="string">&quot;mark&quot;</span>,<span class="string">&quot;marquee&quot;</span>,<span class="string">&quot;menu&quot;</span>,<span class="string">&quot;menuitem&quot;</span>,<span class="string">&quot;meta&quot;</span>,<span class="string">&quot;meter&quot;</span>,<span class="string">&quot;multicol&quot;</span>,<span class="string">&quot;nav&quot;</span>,<span class="string">&quot;nextid&quot;</span>,<span class="string">&quot;nobr&quot;</span>,<span class="string">&quot;noembed&quot;</span>,<span class="string">&quot;noframes&quot;</span>,<span class="string">&quot;noscript&quot;</span>,<span class="string">&quot;object&quot;</span>,<span class="string">&quot;ol&quot;</span>,<span class="string">&quot;optgroup&quot;</span>,<span class="string">&quot;option&quot;</span>,<span class="string">&quot;output&quot;</span>,<span class="string">&quot;p&quot;</span>,<span class="string">&quot;param&quot;</span>,<span class="string">&quot;picture&quot;</span>,<span class="string">&quot;plaintext&quot;</span>,<span class="string">&quot;pre&quot;</span>,<span class="string">&quot;progress&quot;</span>,<span class="string">&quot;q&quot;</span>,<span class="string">&quot;rb&quot;</span>,<span class="string">&quot;rp&quot;</span>,<span class="string">&quot;rt&quot;</span>,<span class="string">&quot;rtc&quot;</span>,<span class="string">&quot;ruby&quot;</span>,<span class="string">&quot;s&quot;</span>,<span class="string">&quot;samp&quot;</span>,<span class="string">&quot;script&quot;</span>,<span class="string">&quot;section&quot;</span>,<span class="string">&quot;select&quot;</span>,<span class="string">&quot;shadow&quot;</span>,<span class="string">&quot;slot&quot;</span>,<span class="string">&quot;small&quot;</span>,<span class="string">&quot;source&quot;</span>,<span class="string">&quot;spacer&quot;</span>,<span class="string">&quot;span&quot;</span>,<span class="string">&quot;strike&quot;</span>,<span class="string">&quot;strong&quot;</span>,<span class="string">&quot;style&quot;</span>,<span class="string">&quot;sub&quot;</span>,<span class="string">&quot;summary&quot;</span>,<span class="string">&quot;sup&quot;</span>,<span class="string">&quot;svg&quot;</span>,<span class="string">&quot;table&quot;</span>,<span class="string">&quot;tbody&quot;</span>,<span class="string">&quot;td&quot;</span>,<span class="string">&quot;template&quot;</span>,<span class="string">&quot;textarea&quot;</span>,<span class="string">&quot;tfoot&quot;</span>,<span class="string">&quot;th&quot;</span>,<span class="string">&quot;thead&quot;</span>,<span class="string">&quot;time&quot;</span>,<span class="string">&quot;title&quot;</span>,<span class="string">&quot;tr&quot;</span>,<span class="string">&quot;track&quot;</span>,<span class="string">&quot;tt&quot;</span>,<span class="string">&quot;u&quot;</span>,<span class="string">&quot;ul&quot;</span>,<span class="string">&quot;var&quot;</span>,<span class="string">&quot;video&quot;</span>,<span class="string">&quot;wbr&quot;</span>,<span class="string">&quot;xmp&quot;</span>], logs = [];</span><br><span class="line">div=<span class="built_in">document</span>.createElement(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line"><span class="function"><span class="title">for</span>(<span class="params"><span class="keyword">var</span> i=<span class="number">0</span>;i&lt;html.length;i++</span>)</span> &#123;</span><br><span class="line">  <span class="function"><span class="title">for</span>(<span class="params"><span class="keyword">var</span> j=<span class="number">0</span>;j&lt;html.length;j++</span>)</span> &#123;</span><br><span class="line">    div.innerHTML=<span class="string">&#x27;&lt;&#x27;</span>+html[i]+<span class="string">&#x27; id=element1&gt;&#x27;</span>+<span class="string">&#x27;&lt;&#x27;</span>+html[j]+<span class="string">&#x27; id=element2&gt;&#x27;</span>;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(div);</span><br><span class="line">    <span class="function"><span class="title">if</span>(<span class="params"><span class="built_in">window</span>.element1 &amp;&amp; element1.element2</span>)</span>&#123;</span><br><span class="line">       log.push(html[i]+<span class="string">&#x27;,&#x27;</span>+html[j]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">document</span>.body.removeChild(div);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(log.join(<span class="string">&#x27;\n&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>可以得到以下的关系：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">form-&gt;button</span><br><span class="line">form-&gt;fieldset</span><br><span class="line">form-&gt;image</span><br><span class="line">form-&gt;img</span><br><span class="line">form-&gt;input</span><br><span class="line">form-&gt;object</span><br><span class="line">form-&gt;output</span><br><span class="line">form-&gt;select</span><br><span class="line">form-&gt;textarea</span><br></pre></td></tr></table></figure>

<p>这也是为什么第四张图劫持函数可以成功的原因；</p>
<p>用此构建成x.y；结合之前的返回string；就可以构造出相应的payload;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form id&#x3D;x&gt;</span><br><span class="line">&lt;button id&#x3D;y&gt;down&lt;&#x2F;button&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">console.log(x.y);&#x2F;&#x2F;&lt;button id&#x3D;&quot;y&quot;&gt;down&lt;&#x2F;button&gt;</span><br></pre></td></tr></table></figure>

<p>这种方法无法拿到其value；也算是有点欠佳的方法；尽管有些标签可以返回value；但是也是需要借助value属性才可返回，比如：</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/om30u6"><img src="https://z3.ax1x.com/2021/11/27/om30u6.png" alt="om30u6.png"></a></p>
<p>所以其利用方式也是很局限的;实际中还是最好利用两层同id去造成HtmlCollection然后利用name承接，进行a href的利用较好；</p>
<h2 id="三层利用"><a href="#三层利用" class="headerlink" title="三层利用"></a>三层利用</h2><p>三层利用的关系就需要我们结合上面两种方式；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;x&quot;</span>&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;form id=<span class="string">&quot;x&quot;</span> name=<span class="string">&quot;y&quot;</span>&gt;<span class="xml"><span class="tag">&lt;<span class="name">output</span> <span class="attr">id</span>=<span class="string">z</span>&gt;</span>down<span class="tag">&lt;/<span class="name">output</span>&gt;</span></span></span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>理解一下也不难，先利用同id去造成HtmlCollection去获取第二层，然后在利用form和output来进行第三层的获取；</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/omYVrq"><img src="https://z3.ax1x.com/2021/11/27/omYVrq.png" alt="omYVrq.png"></a></p>
<p>不过缺点和之前一样，因为套了form-&gt;output所以也是无法直接拿到value；</p>
<h2 id="三层以上访问"><a href="#三层以上访问" class="headerlink" title="三层以上访问"></a>三层以上访问</h2><p>三层以上的访问可以通过iframe与srcdoc来实现</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe name=a srcdoc=<span class="string">&quot;</span></span><br><span class="line"><span class="string">&lt;iframe srcdoc=&#x27;&lt;a id=c name=d href=cid:Clobbered&gt;test&lt;/a&gt;&lt;a id=c&gt;&#x27; name=b&gt;&quot;</span>&gt;&lt;/iframe&gt;</span><br><span class="line">&lt;script&gt;<span class="built_in">setTimeout</span>(<span class="function">()=&gt;</span>alert(a.b.c.d),<span class="number">500</span>)&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>这种方式可以直接拿到value；</p>
<p>如果不想通过setTimeout进行延时的话，还可以通过<code>&lt;style&gt;</code>标签或者<code>&lt;script&gt;</code>等进行网络请求造成延时，使得iframe加载完毕;因为在iframe没有记载完毕的时候他的document和加载完之后的document是不一样的；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;iframe name=a srcdoc=<span class="string">&quot;</span></span><br><span class="line"><span class="string">&lt;iframe srcdoc=&#x27;&lt;a id=c name=d href=cid:Clobbered&gt;test&lt;/a&gt;&lt;a id=c&gt;&#x27; name=b&gt;&quot;</span>&gt;&lt;/iframe&gt;</span><br><span class="line">&lt;style&gt;@<span class="keyword">import</span> <span class="string">&#x27;http://example.com&#x27;</span>;&lt;/style&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">alert(a.b.c.d)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<h2 id="任意属性的测试"><a href="#任意属性的测试" class="headerlink" title="任意属性的测试"></a>任意属性的测试</h2><p>这里可以用以下的脚本进行fuzz；fuzz一下看看有没有字符串类型的属性可以让我们使用；</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> html = [...]<span class="comment">//HTML elements array</span></span><br><span class="line"><span class="keyword">var</span> props=[];</span><br><span class="line"><span class="function"><span class="title">for</span>(<span class="params">i=<span class="number">0</span>;i&lt;html.length;i++</span>)</span>&#123;</span><br><span class="line">  obj = <span class="built_in">document</span>.createElement(html[i]);</span><br><span class="line">   <span class="function"><span class="title">for</span>(<span class="params">prop <span class="keyword">in</span> obj</span>)</span> &#123;</span><br><span class="line">    <span class="function"><span class="title">if</span>(<span class="params"><span class="keyword">typeof</span> obj[prop] === <span class="string">&#x27;string&#x27;</span></span>)</span> &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        props.push(html[i]+<span class="string">&#x27;:&#x27;</span>+prop);</span><br><span class="line">      &#125;<span class="function"><span class="title">catch</span>(<span class="params">e</span>)</span>&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log([...new <span class="built_in">Set</span>(props)].join(<span class="string">&#x27;\n&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>可以得到两个有趣的可利用属性 为username和password,但是这两个并非HTML属性，利用如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;a id=x href=<span class="string">&quot;http://Clobbered-username:Clobbered-Password@a&quot;</span>&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">alert(x.username)<span class="comment">//Clobbered-username</span></span><br><span class="line">alert(x.password)<span class="comment">//Clobbered-password</span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>除此之外，还有其他的一些标签结合属性名称，比如a:title</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;a id=x title=<span class="string">&quot;x:alert(1)&quot;</span>&gt;</span><br><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><br><span class="line">	<span class="built_in">console</span>.log(x.y);<span class="comment">//&#x27;x:alert(1)&#x27;</span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>




            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="m-pagination col-md-8 col-md-offset-2 col-sm-24" role="pagination">
    
    
    <a class="pull-right" href="/2021/09/27/javascript-prototype-pollution/">
        javascript prototype pollution →
    </a>
    
</nav>

        <div class="col-md-8 col-md-offset-2 col-sm-24"><script type="text/javascript">
  /**
   * 搜狐畅言
   */

  /*
  document.write('<div id="SOHUCS" sid="' + window.location.pathname.slice(1) + '" ></div>');

  window.onload = function () {
    (function () {
      var appid = 'cytXXXX';
      var conf = 'prod_xxxxxxxxxxxxxxxxx';
      var width = window.innerWidth || document.documentElement.clientWidth;
      var loadJs = function (d, a, id) {
        var c = document.getElementsByTagName("head")[0] || document.head || document.documentElement;
        var b = document.createElement("script");
        b.setAttribute("type", "text/javascript");
        b.setAttribute("charset", "UTF-8");
        b.setAttribute("src", d);
        if (id) {
          b.setAttribute("id", id);
        }
        if (typeof a === "function") {
          if (window.attachEvent) {
            b.onreadystatechange = function () {
              var e = b.readyState;
              if (e === "loaded" || e === "complete") {
                b.onreadystatechange = null;
                a()
              }
            }
          } else {
            b.onload = a
          }
        }
        c.appendChild(b)
      };

      loadJs("https://changyan.sohu.com/upload/changyan.js", function () {
        window.changyan.api.config({
          appid: appid,
          conf: conf
        })
      });
    })();
  }
  */

</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By s1mple. All Rights Reserved.
                </p>
                <p>Theme By <a target="_blank" rel="noopener" href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://weibo.com/" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };

    resizeHero();

    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$('#intro').find('img').each(function(){
  var alt = this.alt;

  if (alt){
    $(this).after('<span class="caption" style="display:none">' + alt + '</span>');
  }

  $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox" rel="gallery" />');
});
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



      
</body>
</html>
